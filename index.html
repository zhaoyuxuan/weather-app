<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css" integrity="sha384-PsH8R72JQ3SOdhVi3uxftmaW6Vc51MKb0q5P2rRUpPvrszuE4W1povHYgTpBfshb" crossorigin="anonymous">
    <link rel="stylesheet" href="/css/styles.css">
    <link rel="stylesheet" href="/css/weather-icons-wind.css">
    <link rel="stylesheet" href="/css/weather-icons.css">
    <link rel="stylesheet" href="/css/weather-icons-wind.min.css">
    <link rel="stylesheet" href="/css/weather-icons.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBbeK2be4_yk5PnDfBdMhxqAB5YNfLbyuA&callback=initMap">
    </script>


    <title>Weather App</title>
  </head>
  <body>
    <div class="container-fluid">
      <div class = "row justify-content-center" id ="title">
        WEATHER APP
      </div>

      <div class = "row justify-content-center" >
        <input type="text" id ="inputcity" placeholder="Enter City" list="cityList" onkeydown="check()"></input>
      </div>
      <div class = "row infogroup" style= "margin-top: 10%; display:none">
        <div class = col-md-1></div>
        <div class = "col-md-2 text-center center-block"  id="first weather">
          <i id="icon1"></i>
          <div class = "maintemperature" id="main1">-80˚C</div>
          <div class = "windspeed" id= "windspeed1" style="font-weight: bold;">Windspeed: &nbsp;-100˚C</div>
          <div class = "humidity" id="humidity1" style="font-weight: bold;">Humidity: &nbsp;-100˚C</div>
          <div style="padding-bottom: 1em;"></div>
          <div class = "weatherstate text-center" id="weatherstate1">Sunny</div>
          
        </div>
         <div class = "col-md-2 text-center center-block"  id="first weather">
          <i id="icon2"></i>
          <div class = "maintemperature" id="main2">-80˚C</div>
          <div class = "windspeed" id= "windspeed2" style="font-weight: bold;">Windspeed: &nbsp;-100˚C</div>
          <div class = "humidity" id="humidity2" style="font-weight: bold;">Humidity: &nbsp;-100˚C</div>
          <div style="padding-bottom: 1em;"></div>
          <div class = "weatherstate text-center" id="weatherstate1">Sunny</div>
          
        </div>
         <div class = "col-md-2 text-center center-block"  id="first weather">
          <i id="icon3"></i>
          <div class = "maintemperature" id="main3">-80˚C</div>
          <div class = "windspeed" id= "windspeed3" style="font-weight: bold;">Windspeed: &nbsp;-100˚C</div>
          <div class = "humidity" id="humidity3" style="font-weight: bold;">Humidity: &nbsp;-100˚C</div>
          <div style="padding-bottom: 1em;"></div>
          <div class = "weatherstate text-center" id="weatherstate2">Sunny</div>
          
        </div>
         <div class = "col-md-2 text-center center-block"  id="first weather">
          <i id="icon4"></i>
          <div class = "maintemperature" id="main4">-80˚C</div>
          <div class = "windspeed" id= "windspeed4" style="font-weight: bold;">Windspeed: &nbsp;-100˚C</div>
          <div class = "humidity" id="humidity4" style="font-weight: bold;">Humidity: &nbsp;-100˚C</div>
          <div style="padding-bottom: 1em;"></div>
          <div class = "weatherstate text-center" id="weatherstate3">Sunny</div>
          
        </div>
         <div class = "col-md-2 text-center center-block"  id="first weather">
          <i id="icon5"></i>
          <div class = "maintemperature" id="main5">-80˚C</div>
          <div class = "windspeed" id= "windspeed5" style="font-weight: bold;">Windspeed: &nbsp;-100˚C</div>
          <div class = "humidity" id="humidity5" style="font-weight: bold;">Humidity: &nbsp;-100˚C</div>
          <div style="padding-bottom: 1em;"></div>
          <div class = "weatherstate text-center" id="weatherstate4">Sunny</div>

          
          
        </div>

        <div class = col-md-1></div>
    
      </div>
      <div class = "row">
        <div class = col-md-1></div>
        <div class = col-md-10>
          <div class = "row" id="map" style='height: 100%;background-color:#08c;width: 100% ;padding-bottom:35%;margin-top: 5%; display: none'></div>
          
        </div>
        <div class = col-md-1></div>
      </div>
      
      <script type="text/javascript">
      function initMap(location) {
          var map = new google.maps.Map(document.getElementById('map'), {
              zoom: 6,
              center: location,
              streetViewControl: false,
              mapTypeControl: false
          });
          map.setOptions({
              zoomControl: true,
              gestureHandling: 'none'
          });
          var marker = new google.maps.Marker({
              position: location,
              map: map
          });
      }
    </script>
    
    </div>
          
  </body>


<script type="text/javascript">
  function getcityoption(){
    var formData = new FormData();
  
     $.ajax({
            type: "POST",
            url: "/citydata",
            data: formData,
            contentType: false,
            processData: false,
            success: function(response) {
                localStorage.setItem("citydata",JSON.stringify(response));
            }
        });
  }
  
</script>
<script type="text/javascript">
  getcityoption();
  
  var citydata = JSON.parse(localStorage.citydata);
  var searchData = [];
  for (cityid in citydata) {
      searchData.push({
          label: citydata[cityid],
          value: cityid
      })
  }

  function check() {

      $("#inputcity").autocomplete({
          source: function(request, response) {
              var results = $.ui.autocomplete.filter(searchData, request.term);
              response(results.slice(0, 10));

          },
          select: function(event, ui) {
              event.preventDefault();
              $("#inputcity").val(ui.item.label);
              var inputid = ui.item.value;
              var formData = new FormData();
              formData.set("userInput", inputid);
              $.ajax({
                  type: "POST",
                  url: "/weatherdata",
                  data: formData,
                  contentType: false,
                  processData: false,
                  success: function(response) {
                
                      let location = {
                          lat: 53.55,
                          lng: -113.47
                      };
                      let locationdata = response["city"]["coord"]
                      location["lat"] = locationdata["lat"];
                      location["lng"] = locationdata["lon"];

                      initMap(location)
                      response = response["list"]


                      $(".infogroup").show();
                      $("#map").show();
                      for (i = 1; i < 6; i++) {
                          $("#main" + i).text(Math.round(response[i - 1]["main"]["temp"] - 273.15) + "˚C");
                          $("#windspeed" + i).text("Windspeed: " + response[i - 1]["wind"]["speed"] + "m/s");
                          $("#humidity" + i).text("Humidity: " + response[i - 1]["main"]["humidity"]);
                          $("#weatherstate" + i).text(response[i - 1]["weather"][0]["main"]);
                          var weathercode = response[i - 1]["weather"][0]["id"];
                          console.log(weathercode);
                          $("#icon" + i).addClass("wi wi-owm-" + weathercode + " wi-fw");
                      }
                  }
              });


          },
          focus: function(event, ui) {
              event.preventDefault();
              $("#inputcity").val(ui.item.label);
          }
      });
  }
  
  $.ui.autocomplete.filter = function(array, term) {
      var matcher = new RegExp("^" + $.ui.autocomplete.escapeRegex(term), "i");
      return $.grep(array, function(value) {
          return matcher.test(value.label || value.value || value);
      });

  };

</script>
</html>

