<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css" integrity="sha384-PsH8R72JQ3SOdhVi3uxftmaW6Vc51MKb0q5P2rRUpPvrszuE4W1povHYgTpBfshb" crossorigin="anonymous">
    <link rel="stylesheet" href="/css/styles.css">
    <link rel="stylesheet" href="/css/weather-icons-wind.css">
    <link rel="stylesheet" href="/css/weather-icons.css">
    <link rel="stylesheet" href="/css/weather-icons-wind.min.css">
    <link rel="stylesheet" href="/css/weather-icons.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

    <title>Weather App</title>
  </head>
  <body>
    <div class="container-fluid">
      <div class = "row justify-content-center" id ="title">
        WEATHER APP
      </div>

      <div class = "row justify-content-center" >
        <input type="text" id ="inputcity" placeholder="Enter City" list="cityList" onkeydown="check()"></input>
      </div>
      <div class = "row infogroup" style= "margin-top: 10%; display:none">
        <div class = col-md-1></div>
        <div class = "col-md-2 text-center center-block"  id="first weather">
          <i id="icon1"></i>
          <div class = "maintemperature" id="main1">-80˚C</div>
          <div class = "windspeed" id= "windspeed1" style="font-weight: bold;">Windspeed: &nbsp;-100˚C</div>
          <div class = "humidity" id="humidity1" style="font-weight: bold;">Humidity: &nbsp;-100˚C</div>
          <div style="padding-bottom: 1em;"></div>
          <div class = "weatherstate text-center" id="weatherstate1">Sunny</div>
          
        </div>
         <div class = "col-md-2 text-center center-block"  id="first weather">
          <i id="icon2"></i>
          <div class = "maintemperature" id="main2">-80˚C</div>
          <div class = "windspeed" id= "windspeed2" style="font-weight: bold;">Windspeed: &nbsp;-100˚C</div>
          <div class = "humidity" id="humidity2" style="font-weight: bold;">Humidity: &nbsp;-100˚C</div>
          <div style="padding-bottom: 1em;"></div>
          <div class = "weatherstate text-center" id="weatherstate1">Sunny</div>
          
        </div>
         <div class = "col-md-2 text-center center-block"  id="first weather">
          <i id="icon3"></i>
          <div class = "maintemperature" id="main3">-80˚C</div>
          <div class = "windspeed" id= "windspeed3" style="font-weight: bold;">Windspeed: &nbsp;-100˚C</div>
          <div class = "humidity" id="humidity3" style="font-weight: bold;">Humidity: &nbsp;-100˚C</div>
          <div style="padding-bottom: 1em;"></div>
          <div class = "weatherstate text-center" id="weatherstate1">Sunny</div>
          
        </div>
         <div class = "col-md-2 text-center center-block"  id="first weather">
          <i id="icon4"></i>
          <div class = "maintemperature" id="main4">-80˚C</div>
          <div class = "windspeed" id= "windspeed4" style="font-weight: bold;">Windspeed: &nbsp;-100˚C</div>
          <div class = "humidity" id="humidity4" style="font-weight: bold;">Humidity: &nbsp;-100˚C</div>
          <div style="padding-bottom: 1em;"></div>
          <div class = "weatherstate text-center" id="weatherstate4">Sunny</div>
          
        </div>
         <div class = "col-md-2 text-center center-block"  id="first weather">
          <i id="icon5"></i>
          <div class = "maintemperature" id="main5">-80˚C</div>
          <div class = "windspeed" id= "windspeed5" style="font-weight: bold;">Windspeed: &nbsp;-100˚C</div>
          <div class = "humidity" id="humidity5" style="font-weight: bold;">Humidity: &nbsp;-100˚C</div>
          <div style="padding-bottom: 1em;"></div>
          <div class = "weatherstate text-center" id="weatherstate1">Sunny</div>
          
        </div>

        <div class = col-md-1></div>
      </div>
    </div>
          
  </body>


<script type="text/javascript">
  function getcityoption(){
    var formData = new FormData();
    formData.set("userInput", "cityname");
     $.ajax({
            type: "POST",
            url: "/citydata",
            data: formData,
            contentType: false,
            processData: false,
            success: function(response) {
                localStorage.setItem("citydata",JSON.stringify(response));
            }
        });
  }
  window.onload = getcityoption;
</script>
<script type="text/javascript">
  var citydata = JSON.parse(localStorage.citydata);
  var searchData = [];
  for (cityid in citydata) {
      searchData.push({
          label: citydata[cityid],
          value: cityid
      })
  }

  function check() {

      $("#inputcity").autocomplete({
          source: function(request, response) {
              var results = $.ui.autocomplete.filter(searchData, request.term);
              response(results.slice(0, 10));

          },
          select: function(event, ui) {
              event.preventDefault();
              $("#inputcity").val(ui.item.label);
              var inputid = ui.item.value;
              console.log(inputid);
              var formData = new FormData();
              formData.set("userInput", inputid);
            $.ajax({
                type: "POST",
                url: "/weatherdata",
                data: formData,
                contentType: false,
                processData: false,
                success: function(response) {
                    $(".infogroup").show();
                    for (i = 1; i < 6; i++) { 
                    $("#main"+i).text(Math.round(response[i-1]["main"]["temp"] - 273.15) + "˚C");
                    $("#windspeed"+i).text("Windspeed: " + response[i-1]["wind"]["speed"] + "m/s");
                    $("#humidity"+i).text("Humidity: " + response[i-1]["main"]["humidity"]);
                    $("#weatherstate"+i).text(response[i-1]["weather"][0]["main"]);
                    var weathercode = response[i-1]["weather"][0]["id"];
                    $("#icon"+i).addClass("wi wi-owm-"+weathercode+" wi-fw");
                      }
                }
            });


          },
          focus: function(event, ui) {
              event.preventDefault();
              $("#inputcity").val(ui.item.label);
          }
      });
  }
  
  $.ui.autocomplete.filter = function(array, term) {
      var matcher = new RegExp("^" + $.ui.autocomplete.escapeRegex(term), "i");
      return $.grep(array, function(value) {
          return matcher.test(value.label || value.value || value);
      });

  };

</script>
</html>

