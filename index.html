<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css" integrity="sha384-PsH8R72JQ3SOdhVi3uxftmaW6Vc51MKb0q5P2rRUpPvrszuE4W1povHYgTpBfshb" crossorigin="anonymous">
    <link rel="stylesheet" href="/css/styles.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

    <title>Weather App</title>
  </head>
  <body>
    <div class="container-fluid">
      <div class = "row justify-content-center" id ="title">
        WEATHER APP
      </div>

      <div class = "row justify-content-center" >
        <input type="text" id ="inputcity" placeholder="Enter City" list="cityList" onkeydown="check()"></input>
      </div>
      <div class = "row" style= "margin-top: 10%">
        <div class = col-md-1></div>
        <div class = "col-md-2 text-center center-block"  id="first weather">
          <img id ="image1" src="../weathericon/if_sun_2016199.svg" width="100vw" height="100vh" />
          <div class = "maintemperature">-80˚C</div>
          <div class = "windspeed" style="font-weight: bold;">Windspeed: &nbsp;-100˚C</div>
          <div class = "humidity" style="font-weight: bold;">Humidity: &nbsp;-100˚C</div>
          <div style="padding-bottom: 1em;"></div>
          <div class = "weatherstate text-center" id="weatherstate1">Sunny</div>
        </div>

        <div class = col-md-1></div>
      </div>
    </div>
          
  </body>


<script type="text/javascript">
  function getcityoption(){
    var formData = new FormData();
    formData.set("userInput", "cityname");
     $.ajax({
            type: "POST",
            url: "/citydata",
            data: formData,
            contentType: false,
            processData: false,
            success: function(response) {
                localStorage.setItem("citydata",JSON.stringify(response));
            }
        });
  }
  window.onload = getcityoption;
</script>
<script type="text/javascript">
  var citydata = JSON.parse(localStorage.citydata);
  var searchData = [];
  for (cityid in citydata) {
      searchData.push({
          label: citydata[cityid],
          value: cityid
      })
  }

  function check() {

      $("#inputcity").autocomplete({
          source: function(request, response) {
              var results = $.ui.autocomplete.filter(searchData, request.term);
              response(results.slice(0, 10));

          },
          select: function(event, ui) {
              event.preventDefault();
              $("#inputcity").val(ui.item.label);
              var input = ui.item.value;
              // TODO attach label to menu
              console.log("value" + ui.item.value);
              console.log("label" + ui.item.label);

          },
          focus: function(event, ui) {
              event.preventDefault();
              $("#inputcity").val(ui.item.label);
          }
});


  }
  
  $.ui.autocomplete.filter = function(array, term) {
      var matcher = new RegExp("^" + $.ui.autocomplete.escapeRegex(term), "i");
      return $.grep(array, function(value) {
          return matcher.test(value.label || value.value || value);
      });

  };

</script>
</html>

